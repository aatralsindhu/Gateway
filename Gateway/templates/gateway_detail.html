{% extends "base.html" %}
{% block title %}{{ gateway.name }} Details - IH Gateway{% endblock %}

{% block content %}
<style>
/* ====== Gateway Details Custom Styles ====== */
.ih-card {
    background: #ffffff;
    border-radius: 1rem;
    padding: 2rem;
    box-shadow: 0 4px 15px rgba(0,0,0,0.05);
}

h2 {
    font-weight: 700;
    color: #2c3e50;
}

.badge {
    font-size: 0.85rem;
    padding: 0.5em 0.75em;
}

.table {
    border-radius: 0.75rem;
    overflow: hidden;
}

.table thead {
    background-color: #f7f9fc;
    font-weight: 600;
}

.table tbody tr:hover {
    background-color: #f1f5fa;
    transition: background-color 0.2s ease-in-out;
}

.section-card {
    border: 1px solid #eaeaea;
    border-radius: 0.75rem;
    padding: 1.25rem;
    background: #fafbfc;
    margin-bottom: 1.5rem;
    box-shadow: 0 2px 6px rgba(0,0,0,0.03);
}

.section-card h4 {
    font-weight: 600;
    color: #34495e;
}

.btn {
    border-radius: 0.5rem;
    font-weight: 500;
}

.btn-primary {
    background-color: #3b82f6;
    border: none;
}

.btn-primary:hover {
    background-color: #2563eb;
}

.btn-info {
    background-color: #0ea5e9;
    border: none;
}

.btn-info:hover {
    background-color: #0284c7;
}

.btn-warning {
    background-color: #f59e0b;
    border: none;
}

.btn-warning:hover {
    background-color: #d97706;
}

.btn-danger {
    background-color: #ef4444;
    border: none;
}

.btn-danger:hover {
    background-color: #dc2626;
}

/* Modal styling tweaks */
.modal-header {
    background-color: #f9fafb;
    border-bottom: 1px solid #e5e7eb;
}

.modal-footer {
    background-color: #f9fafb;
    border-top: 1px solid #e5e7eb;
}
.breadcrumb {
    background: #f8f9fa; /* light gray background */
    border-radius: 0.375rem; /* rounded corners */
    padding: 0.5rem 1rem;
    font-size: 0.9rem;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
  }
  .breadcrumb-item + .breadcrumb-item::before {
    content: ">";
    color: #6c757d;
    padding: 0 0.5rem;
  }
  .breadcrumb-item a {
    color: #0d6efd; /* bootstrap primary blue */
    text-decoration: none;
    transition: color 0.3s ease;
  }
  .breadcrumb-item a:hover {
    color: #0a58ca;
    text-decoration: underline;
  }
  .breadcrumb-item.active {
    color: #495057; /* slightly darker gray for active */
    font-weight: 600;
  }
</style>
<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="{% url 'gateway_list' %}">Gateway List</a></li>
        <li class="breadcrumb-item active" aria-current="page">{{ gateway.name }}</li>
    </ol>
</nav>
<div class="ih-card">
    <h2 class="mb-3">{{ gateway.name }}</h2>
    <p class="text-muted">{{ gateway.description }}</p>
    

    <div class="mb-4">
        <a href="{% url 'add_inbound_connector' gateway.id %}" class="btn btn-info me-2">+ Add Inbound Connector</a>
        <a href="{% url 'add_outbound_connector' gateway.id %}" class="btn btn-warning">+ Add Outbound Connector</a>
    </div>

    <!-- Inbound Connectors Section -->
    <div class="section-card">
        <h4 class="mb-3">Inbound Connectors</h4>
        <table class="table table-sm table-bordered mb-0">
            <div class="d-flex justify-content-end mb-3">
<form id="importForm" method="post" enctype="multipart/form-data"
      action="{% url 'import_gateway_config' gateway_id=gateway.id %}">
        {% csrf_token %}
        <input type="file" name="config_file" accept=".json" required>
        <button type="submit" class="btn btn-success btn-sm">Import Configuration</button>
    </form>
</div>
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Type</th>
                    <th>Status</th>
                    <th style="width: 180px;">Actions</th>
                </tr>
            </thead>
            <tbody>
            {% for c in inbound_connectors %}
                <tr>
                    <td>{{ c.name }}</td>
                    <td>{{ c.get_connector_type_display }}</td>
                     <td>
            <span class="badge {% if c.status == 'active' %}bg-success{% else %}bg-secondary{% endif %}">
                {{ c.get_status_display }}
            </span>
        </td>
                    <td>
                        <a href="{% url 'edit_inbound_connector' c.id %}" class="btn btn-sm btn-primary me-1">Edit</a>
                        <button type="button"
                                class="btn btn-danger btn-sm delete-btn"
                                data-bs-toggle="modal"
                                data-bs-target="#deleteModal"
                                data-name="{{ c.name }}"
                                data-url="{% url 'delete_connector' direction='inbound' connector_pk=c.id %}">
                            Delete
                        </button>
                    </td>
                </tr>
            {% empty %}
                <tr><td colspan="3" class="text-center text-muted">No inbound connectors.</td></tr>
            {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Outbound Connectors Section -->
    <div class="section-card">
        <h4 class="mb-3">Outbound Connectors</h4>
        <table class="table table-sm table-bordered mb-0">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Type</th>
                    <th>Status</th>
                    <th style="width: 180px;">Actions</th>
                </tr>
            </thead>
            <tbody>
            {% for c in outbound_connectors %}
                <tr>
                    <td>{{ c.name }}</td>
                    <td>{{ c.get_connector_type_display }}</td>
                    <td>
            <span class="badge {% if c.status == 'active' %}bg-success{% else %}bg-secondary{% endif %}">
                {{ c.get_status_display }}
            </span>
        </td>
                    <td>
                        <a href="{% url 'edit_oudbound_connector' c.id %}" class="btn btn-sm btn-primary me-1">Edit</a>
                        <button type="button"
                                class="btn btn-danger btn-sm delete-btn"
                                data-bs-toggle="modal"
                                data-bs-target="#deleteModal"
                                data-name="{{ c.name }}"
                                data-url="{% url 'delete_connector' direction='outbound' connector_pk=c.id %}">
                            Delete
                        </button>
                    </td>
                </tr>
            {% empty %}
                <tr><td colspan="3" class="text-center text-muted">No outbound connectors.</td></tr>
            {% endfor %}
            </tbody>
        </table>
    </div>

    <a href="{% url 'gateway_list' %}" class="btn btn-secondary mt-3">â¬… Back to Gateway List</a>
</div>

<!-- Single Delete Confirmation Modal -->
<div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <form method="post" id="deleteForm">
        {% csrf_token %}
        <div class="modal-header">
          <h5 class="modal-title" id="deleteModalLabel">Confirm Delete</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body text-center">
          <p>Are you sure you want to delete <strong id="connectorName"></strong>?</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-danger">Yes, Delete</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Bootstrap 5 JS bundle -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<!-- Modal Dynamic Content Script -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    const deleteModal = document.getElementById('deleteModal');
    deleteModal.addEventListener('show.bs.modal', function(event) {
        const button = event.relatedTarget;
        const name = button.getAttribute('data-name');
        const url = button.getAttribute('data-url');
        document.getElementById('connectorName').textContent = name;
        document.getElementById('deleteForm').action = url;
    });
});
</script>
{% endblock %}
